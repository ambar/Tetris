define("./game",["./tetris/tetris"],function(a,b,c){var d=a("./tetris/tetris");d.theme="classic",d.init("#snake-game",10,20,1)});
define("./tetris/tetris",["../wo/wo","../wo/input","../wo/stage","../wo/vector","../wo/color","../wo/events","../wo/entities","./brick","./wall","./brickdrawer","./background"],function(a,b,c){var d=a("../wo/wo"),e=a("../wo/input"),f=a("../wo/stage"),g=a("../wo/vector"),h=a("../wo/color").Color,i=a("../wo/events").EventEmitter,j=a("../wo/entities"),k=d.$query,l=e.letterFromKeyCode,m=j.Entity,n=j.GameText,o=a("./brick"),p=a("./wall"),q=a("./brickdrawer"),r=a("./background"),s=this,t=s,u=s.document,v,w,x,y,z,A=40,B=1,C=12,D=12,E=0,F=8e3,G=0,H=[37,38,39,40],I=0,J=0,K=!1,L=!1,M=!0,N=null,O=null,P=null,Q=null,R=null,S=function(a){return Math.ceil(a/A)},T=function(){return g([rand(I-1),rand(J-1)])},U=function(a){var b=new n(f.width/2,f.height/2,a,A*1.5),c=document.querySelector("#snake-game-wrapper .panel"),d=document.defaultView.getComputedStyle(c).getPropertyValue("font-family");return b.fontFamily=d,b},V=function(a,b,c,d){var e=A*b,g=A*c;f.init(a,e,g,d),I=S(e),J=S(g),w=k("#tetris-fps"),v=k("#tetris-score"),x=k("#tetris-level"),Q=k("#snake-game-bg").getContext("2d"),R=k("#snake-game-next").getContext("2d"),Q.canvas.parentNode.style.width=f.width*d+"px",Q.canvas.parentNode.style.height=f.height*d+"px",r.init(Q),q.resetCanvas(Q,b,c,d),P=U("PAUSED"),Y(),t.addEventListener("keydown",function(a){var b=a.keyCode;H.indexOf(b)>-1&&a.preventDefault();switch(l(b)){case"r":Z();break;case"p":f.running=!f.running;break;case"c":q.randomizeTheme(),q.drawPreview(o.instances.next),K&&f.drawAll();break;case"d":_.showGrid=!_.showGrid}},!1)},W=function(){var a=function(b,c,d,e){return e===~~(b/2)?b%2?d:c:a(b,c+d,c+d+d,e+1)};return function(b){return a(b,0,1,0)}}(),X=function(a){if(a<E)return;D=f.fps=C+(a-1)*5,x.text(E=a)},Y=function(){if(L)return;$(),X(1),N=new p,N.on("eraseRows",function(a,b){G+=b===1?100:W(b+2)*100,v.text(G),X(Math.floor(G/F))}),f.add(N),M&&r.draw(),f.on("update",function(){w&&w.text(this.fpsNow)}),o.spawn(),f.on("pause",function(){K||(f.add(P),f.once("run",function(){f.remove(P)}))})},Z=function(){f.reset().run(),Y()},$=function(){v.text(G=0),E=0,D=f.fps=C,K=L=!1,o.resetInstances()},_=Object.create({},{unit:{get:function(){return A},set:function(a){A=a}},score:{get:function(){return G}},fps:{get:function(){return D}},showGrid:{get:function(){return M},set:function(a){a=!!a,a!==M&&(M=a,M?r.draw():r.clear())}},bgContext:{get:function(){return Q}},nextContext:{get:function(){return R}},maxCols:{get:function(){return I}},maxRows:{get:function(){return J}},wall:{get:function(){return N}},theme:{get:function(){return q.currentTheme},set:function(a){q.currentTheme=a}},init:{value:V},play:{value:Y},restart:{value:Z}});Object.extend(_,i),_.on("lose",function(){K=!0,f.add(U("GAME OVER")),setTimeout(f.pause.bind(f))}),c.exports=s.TetrisGame=_});
define("./wo/wo",["./protos"],function(a,b,c){a("./protos");var d={};d.rand=function(a,b){return b||(b=0),Math.round(Math.random()*(a-b))+b},d.makeArray=function(a){return Array.prototype.slice.call(a,0)},d.throttle=function(a,b,c,d){var e=Date.now,f=0,g=0,h=null,i,j,k,l,m=function(){g=e(),b.apply(k,l)};return function(){k=this,l=arguments,i=e(),j=i-(d?f:g)-a,clearTimeout(h),d?c?h=setTimeout(m,a):j>=0&&m():j<0?c&&(h=setTimeout(m,-j)):m(),f=i}},d.debounce=function(a,b,c){return d.throttle(a,b,c,!0)},d.unfold=function(a,b){var c=a,d=[],e=0;do d.push(c);while((c=b(c,e++))!=null);return d},d.repeat=function(a,b){return d.unfold(a,function(a,c){if(c<b-1)return a})},d.$query=function(a){return document.querySelector(a)},d.inherits=function(a,b){a.prototype=Object.create(b.prototype,{constructor:{value:a}}),a.super=b.prototype},Object.extend=function(a,b){for(var c in b)a[c]=b[c];return a},c.exports=d});
define("./wo/protos",[],function(a,b,c){HTMLElement.prototype.bind=function(a,b){return this.addEventListener(a,b,!0),this},HTMLElement.prototype.text=function(a){return this.textContent=a,this},Number.prototype.times=function(a,b){var c=0,d=this.valueOf();b=b||this,d<0&&(d=0);while(c<d)a.call(b,c++)},Array.prototype.first=function(){return this[0]},Array.prototype.last=function(){return this[this.length-1]},Array.prototype.removeAt=function(a,b){return this.splice(a,b||1)},Array.prototype.remove=function(a,b){var c=this,d=0,e=c.length;for(;d<e;d++)if(c[d]===a){c.removeAt(d);if(!b)break}return c}});
define("./wo/input",[],function(a,b,c){var d=this,e={},f={states:e,init:function(a){},state:function(a){return this.states[this.queryKeyCode(a)]},isKeyDown:function(a){var b=this.state(a);return!!b&&b.pressed},isKeyUp:function(a){var b=this.state(a);return!!b&&!b.pressed},isKeyPressed:function(a){var b=this.state(a);return!!b&&!b.locked&&b.pressed},lock:function(){var a=e;Object.keys(a).forEach(function(b){a[b].pressed&&(a[b].locked=!0)})},letterFromKeyCode:function(a){return String.fromCharCode(a).toLowerCase()},queryKeyCode:function(a){return typeof a=="string"?g[a.toLowerCase()]:a},anyKeyDown:function(){var a=e;return Object.keys(a).some(function(b,c){return a[b].pressed})}},g={backspace:8,back:8,tab:9,"\t":9,space:32," ":32,"return":13,enter:13,capslock:20,caps:20,escape:27,esc:27,";":186,"-":187,"=":189,"`":192,",":188,".":190,"/":191,"[":219,"]":221,"'":222,"\\":220,semicolon:186,minus:187,equal:189,accent:192,comma:188,period:190,slash:191,lbracket:219,rbracket:221,apostrophe:222,backslash:220,cmd:91,command:91,win:91,windows:91,rcmd:92,rcommand:92,rwin:92,rwindows:92,menu:93,shift:16,ctrl:17,alt:18,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,ins:45,"delete":46,del:46,scrolllock:145,pause:19,"break":19,pausebreak:19,numlock:144,"num/":111,"num*":106,"mum+":107,"mum-":109,"mum.":110,center:12,mum0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,S:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};Object.freeze(g),f.keyMap=g,d.addEventListener("keyup",function(a){f.states[a.keyCode]={pressed:!1}},!1),d.addEventListener("keydown",function(a){var b=e[a.keyCode];b?b.pressed=!0:e[a.keyCode]={pressed:!0}},!1),c.exports=f});
define("./wo/stage",["./input","./requestAnimationFrame","./events"],function(a,b,c){var d=a("./input"),e=a("./requestAnimationFrame"),f=a("./events").EventEmitter,g=Date.now,h={lastUpdate:0,delta:0,start:0},i=function(a,b,c){if(typeof b!="function")throw new TypeError("The argument 'on_tick' must be a function");a||(a=60);var d={fps:a,on_tick:b,running:!1,start:function(){this.running=!0,this.fps===60?e(this.tick,c):setTimeout(this.tick,1e3/this.fps)},tick:function(){d.running&&(d.on_tick(),d.start())},stop:function(){this.running=!1}};return d},j,k={ctx:null,width:0,height:0,detached:[],entities:[],fpsNow:0,frameCount:0,ticker:null,init:function(a,b,c,d){var e=this;a=this.canvas=typeof a=="string"?document.querySelector(a):a;if(!a)throw a.getContext?new Error("No such canvas element."):new Error("CanvasRenderingContext2D is not supported.");this.resize(b||320,c||240,d),this.ctx=a.getContext("2d"),this.ticker=i(j,this.tick.bind(this),this.canvas),this.run(),h.start=g(),this.init=function(){}},resize:function(a,b,c){c||(c=1);var d=a||this.width,e=b||this.height;this.canvas.width=d,this.canvas.height=e,this.canvas.style.width=d*c+"px",this.canvas.style.height=e*c+"px",this.width=d,this.height=e,this.emit("resize")},add:function(a){return a.alive=!0,this.entities.push(a),this.emit("add"),this},clear:function(){return this.ctx.clearRect(0,0,this.width,this.height),this},remove:function(a){return a.alive=!1,this.entities.remove(a),this.emit("remove",a),this},removeAll:function(){return this.entities=[],this.clear(),this},drawAll:function(){var a=this,b=a.ctx;return this.clear(),this.entities.forEach(function(a){a.alive&&a.draw(b)}),this},updateAll:function(){var a=g(),b=a-h.lastUpdate,c=h.delta=b/1e3;h.lastUpdate=a,this.frameCount+=1,this.fpsNow=Math.round(1e3/b);var e=this.entities,f=e.length,i;while(f-->0)i=e[f],i.alive&&i.update(c);return this.emit("update",c),d.lock(),this},run:function(){return this.ticker.running||(this.ticker.start(),this.emit("run"),h.lastUpdate=g()),this},tick:function(){this.updateAll(),this.drawAll()},pause:function(){return this.ticker.running&&(this.ticker.stop(),this.emit("pause"),this.drawAll()),this},reset:function(){return this.removeAll(),this.off(),this}};Object.extend(k,f),Object.defineProperties(k,{running:{get:function(){return this.ticker.running},set:function(a){Boolean(a)?this.run():this.pause()}},fps:{get:function(){return j},set:function(a){j=a,this.ticker&&(this.ticker.fps=a)}}}),k.time=h,c.exports=k});
define("./wo/requestAnimationFrame",[],function(a,b,c){c.exports=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}});
define("./wo/events",[],function(a,b,c){var d={addListener:function(a,b){var c=this._events;return c||(c=this._events={}),c.hasOwnProperty(a)&&c[a]?c[a].push(b):this._events[a]=[b],this},fireEvent:function(a,b){var c=this,d=c._events;d||(d=c._events={});var e=d[a];return e?(e.forEach(function(d){d.call(c,{type:a},b)}),c):c},removeListener:function(a,b){var c=this._events;if(!c||arguments.length===0)return this._events={},this;var d=c[a];return a&&d&&(c[a]=b?d.filter(function(a){return a!==b}):[]),this},once:function(a,b){var c=this,d=function(){c.off(a,d),b.apply(this,arguments)};return c.on(a,d),c}};d.on=d.addListener,d.off=d.removeListener,d.emit=d.fireEvent,b.EventEmitter=d});
define("./wo/vector",[],function(a,b,c){function d(a){if(this instanceof d)Object.defineProperty(this,"el",{writable:!0,value:a||[0,0]}),["x","y","z"].forEach(function(a,b){Object.defineProperty(this,a,{enumerable:!0,get:function(){return this.get(b)}})},this);else return new d(a)}d.prototype={get:function(a){return this.el[a]},set:function(a){return this.el=a,this},add:function(a){var b=a.el;return this.map(function(a,c){return a+b[c]})},sub:function(a){var b=a.el;return this.map(function(a,c){return a-b[c]})},map:function(a){return new d(this.el.map(a))},mul:function(a){return this.map(function(b){return b*a})},eq:function(a){var b=a.el;return this.el.every(function(a,c){return a===b[c]})},inspect:function(){return"Vector["+this.el.join(",")+"]"}},d.up=d([0,-1]),d.down=d([0,1]),d.left=d([-1,0]),d.right=d([1,0]),d.zero=d([0,0]),c.exports=d});
define("./wo/color",["./wo"],function(a,b,c){function e(a){Array.isArray(a)||(a=d.makeArray(arguments));if(a.length<3||a.some(isNaN))throw TypeError("Invalid color arguments");Object.defineProperty(this,"el",{writable:!0,value:a}),["r","g","b","a"].forEach(function(a,b){Object.defineProperty(this,a,{enumerable:!0,get:function(){return this.el[b]},set:function(a){this.el[b]=a}})},this),this.a||(this.a=1)}var d=a("./wo");e.prototype={toString:function(){return"rgba("+this.el.join(",")+")"},toArray:function(){return this.el.slice()}},e.random=function(a){return a||(a=255),new e(d.rand(a),d.rand(a),d.rand(a),1)},e.parse=function(a){var b=function(a){return f>>a*8&255},c=function(a){return(f>>a*4&15)*17},d=[0,0,0,1],f;if(typeof a=="number")f=a,d=[2,1,0].map(b);else{var g=a.slice(1),h=a.slice(0,1);f=parseInt(g,16),h==="#"&&(d=[2,1,0].map(g.length===6?b:c))}return new e(d)},b.Color=e});
define("./wo/entities",["./class","./events"],function(a,b,c){var d=a("./class"),e=a("./events").EventEmitter,f=d.extend({init:function(a,b,c,d){this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0,this.vx=this.vy=0,this.alive=!0},update:function(a){this.x+=this.vx,this.y+=this.vy,this.emit("update",a)},draw:function(a){}});Object.extend(f.prototype,e);var g=f.extend({init:function(a,b,c,d){this._super(a,b),this.rad=c||20,this.color=d||"lime"},draw:function(a){a.fillStyle=this.color,a.beginPath(),a.arc(this.x,this.y,this.rad,0,Math.PI*2,1),a.fill()}}),h=f.extend({text:"",textAlign:"center",textBaseline:"middle",color:"white",drawTypes:["fill"],fontDefaults:["normal","normal",12,"Tahoma"],fontKeys:["fontWeight","fontStyle","fontSize","fontFamily"],init:function(a,b,c,d,e){c&&(this.text=c),e&&(this.color=e);var f=this,g=function(){f.font=h.map(function(a,b){return f.fontKeys[b]==="fontSize"?a+"px":a}).join(" ")},h=this.fontDefaults.slice();this.fontKeys.forEach(function(a,b){Object.defineProperty(this,a,{enumerable:!0,configurable:!1,get:function(){return h[b]},set:function(c){if(a==="fontSize"){c=parseInt(c,10);if(isNaN(c)||c<0)return}h[b]!==c&&(h[b]=c,g())}})},this),this.fontSize=d,this._super(a,b,d,d)},draw:function(a){a.font=this.font,a.textAlign=this.textAlign,a.textBaseline=this.textBaseline,this.drawTypes.forEach(function(b){a[b+"Style"]=this.color,a[b+"Text"](this.text,this.x,this.y)},this)}});b.Entity=f,b.Ball=g,b.GameText=h});
define("./wo/class",[],function(a,b,c){function d(){}var e=!1,f="_super",g=new RegExp("\\b"+f+"\\b"),h=function(a){return typeof a=="function"},i=function(a,b,c){return function(){var d=this[b],e;return this[b]=c,e=a.apply(this,arguments),this[b]=d,e}};d.extend=function(a){function d(){!e&&h(this.init)&&this.init.apply(this,arguments)}e=!0;var b=this.prototype,c=new this;return e=!1,d.super=b,d.extend=arguments.callee,d.prototype=Object.create(c,{constructor:{value:d}}),d.methods=function(a){Object.keys(a).forEach(function(d,e){var j=a[d];c[d]=h(j)&&h(b[d])&&g.test(j)?i(j,f,b[d]):j})},d.methods(a),d},c.exports=d});
define("./tetris/brick",["../wo/wo","../wo/input","../wo/stage","../wo/vector","../wo/entities","./bricktypes","./brickdrawer","./util"],function(a,b,c){var d=a("../wo/wo"),e=a("../wo/input"),f=a("../wo/stage"),g=a("../wo/vector"),h=a("../wo/entities").Entity,i=a("./bricktypes"),j=a("./brickdrawer"),k=a("./util"),l=h.extend({wall:null,parts:[],shape:[],position:g.zero,gravity:g.down,init:function(a,b,c,d){this._super(),this.wall=d,this.type=c,this.position=g([a,b]),this.shape=this.type.shape.slice(),this.parts=l.mapShape(this.position,this.shape),this._input_locked=e.isKeyDown("down")},draw:function(a){var b=this.type;this.parts.forEach(function(c){j.draw(a,c.x,c.y,b)})},move:function(a){if(!a||a.eq(g.zero))return!1;var b=a===this.gravity,c=this.mapParts(a);return this.wall.collideWith(c)?(b&&(this.emit("remove"),this.wall.add(this)),!1):!b&&this.wall.edgeCollideWith(c)?!1:(this.parts=c,this.position=this.position.add(a),!0)},moveDown:function(){this.move(this.gravity)},mapParts:function(a){return this.parts.map(function(b){return b.add(a)})},update:function(){var a;e.isKeyDown("left")&&(a=g.left),e.isKeyDown("right")&&(a=g.right),this.move(a),e.isKeyDown("up")&&this.rotateThrottled();if(!this._input_locked&&e.isKeyDown("down")){f.fps=60,this.moveDown();return}e.isKeyUp("down")&&(f.fps=TetrisGame.fps,this._input_locked=!1);if(f.frameCount%3)return;this.moveDown()},rotate:function(){var a=l.rotateShape(this.shape),b=l.mapShape(this.position,a);!this.wall.collideWith(b)&&!this.wall.edgeCollideWith(b)&&(this.shape=a,this.parts=b)},rotateThrottled:d.throttle(100,function(){this.rotate()})});l.rotateShape=function(a,b){var c=[],d,e=a.length,f=a[0].length;return f.times(function(f){c.push(d=[]),e.times(function(c){d[b?"push":"unshift"](a[c][f])})}),c},l.mapShape=function(a,b){b=b.slice().reverse();var c=[],d=b.length,e=b[0].length;return d.times(function(d){e.times(function(e){b[d][e]&&c.push(a.add(g([e,-d])))})}),c},l.random=function(){var a=Object.keys(i),b=i[a[d.rand(a.length-1)]],c=b.shape,e=c.length,f=c.first().length,g=new l(Math.ceil((TetrisGame.maxCols-f)/2),-e,b,TetrisGame.wall);return g},l.spawn=function(){if(l.instances.current)return null;l.instances.next||(l.instances.next=l.random());var a=l.instances.current=l.instances.next,b=k.array.maxBy(a.parts,"y"),c=g([0,-b.y]),d=a.mapParts(c);return TetrisGame.wall.collideWith(d)?(TetrisGame.emit("lose"),null):(a.parts=d,a.position=a.position.add(c),j.drawPreview(l.instances.next=l.random()),a.once("remove",function(){f.fps=TetrisGame.fps,l.instances.current=null}),f.add(a),a)},l.instances={next:null,current:null},l.resetInstances=function(){l.instances.current=l.instances.next=null},c.exports=l});
define("./tetris/bricktypes",["./hslcolor"],function(a,b,c){var d=a("./hslcolor"),e=function(){var a=1;return function(){return a++}}(),f=c.exports={Z:{id:e(),color:new d(0,1,.47),shape:[[1,1,0],[0,1,1]]},L:{id:e(),color:new d(40,1,.47),shape:[[1,1,1],[1,0,0]]},O:{id:e(),color:new d(60,1,.47),shape:[[1,1],[1,1]]},S:{id:e(),color:new d(120,1,.47),shape:[[0,1,1],[1,1,0]]},I:{id:e(),color:new d(180,1,.47),shape:[[0,0,0,0],[1,1,1,1],[0,0,0,0]]},J:{id:e(),color:new d(240,1,.47),shape:[[1,1,1],[0,0,1]]},T:{id:e(),color:new d(280,1,.47),shape:[[0,1,0],[1,1,1]]},U:{id:e(),color:new d(320,1,.47),shape:[[1,0,1],[1,1,1]]}}});
define("./tetris/hslcolor",["../wo/wo","../wo/color"],function(a,b,c){function f(a){Array.isArray(a)||(a=d.makeArray(arguments));if(a.length<3||a.some(isNaN))throw new TypeError("Invalid color arguments");Object.defineProperty(this,"el",{writable:!0,value:a}),["h","s","l"].forEach(function(a,b){Object.defineProperty(this,a,{enumerable:!0,get:function(){return this.el[b]},set:function(a){this.el[b]=a}})},this)}function g(a,b,c){var d,e,f,g,i;return a/=360,c>.5?e=c+b-c*b:e=c*(b+1),d=c*2-e,f=h(d,e,a+1/3),g=h(d,e,a),i=h(d,e,a-1/3),[f,g,i].map(function(a){return Math.round(a*255)})}function h(a,b,c){return c<0&&(c+=1),c>1&&(c-=1),c*6<1?a+(b-a)*6*c:c*2<1?b:c*3<2?a+(b-a)*(2/3-c)*6:a}var d=a("../wo/wo"),e=a("../wo/color").Color;f.prototype={toString:function(){return"hsl("+this.h+","+this.s*100+"%,"+this.l*100+"%)"},toArray:function(){return this.el.slice()},toRGB:function(){return new e(g.apply(null,this.el))},multiplyComponent:function(a,b,c){var d=this.el;return new f([a,b,c].map(function(a,b){return d[b]*a}))}},c.exports=f});
define("./tetris/brickdrawer",["../wo/wo","../wo/vector","./hslcolor","./bricktypes"],function(a,b,c){var d=a("../wo/wo").rand,e=a("../wo/vector"),f=a("./hslcolor"),g=a("./bricktypes"),h=new f(180,0,.47),i={classic:function(a,b,c,d){var e=TetrisGame.unit,g=b*e,i=c*e,j=e*.15,k=d.color instanceof f?d.color:h,l=k.toString(),m=k.multiplyComponent(1,.876,1.78).toString(),n=k.multiplyComponent(1,1,.9).toString(),o=k.multiplyComponent(1,1,.5).toString();a.translate(g,i);var p=[0,0],q=[e,0],r=[0,e],s=[e,e],t=[j,j],u=[e-j,j],v=[j,e-j],w=[e-j,e-j],x=function(b,c){var d=b.shift();a.beginPath(),a.moveTo(d[0],d[1]),b.forEach(function(b){a.lineTo(b[0],b[1])}),a.closePath(),a.fillStyle=c,a.fill()},y=function(b,c,d){a.beginPath(),a.moveTo(b[0],b[1]),a.lineTo(c[0],c[1]),a.closePath(),a.lineWidth=1,a.strokeStyle=d,a.stroke()};x([p,t,u,q],m),x([p,t,v,r],n),x([q,u,w,s],n),x([t,u,w,v],l),x([r,v,w,s],o),y(t,p,m),y(u,q,m),y(v,r,o),y(w,s,o),a.translate(-g,-i)},window:function(a,b,c,d){var e=TetrisGame.unit,b=b*e,c=c*e,f=e,g=e,h=e/5,i=d.color;a.strokeStyle=i.multiplyComponent(1,.98,.4).toString(),a.fillStyle=i.toString(),a.lineJoin="round",a.lineWidth=h,a.strokeRect(b+h/2,c+h/2,f-h,g-h),a.fillRect(b+h/2,c+h/2,f-h,g-h)},bubble:function(a,b,c,d){var e=TetrisGame.unit,f=Math.PI,g=e/2,b=(b+1)*e-e/2,c=(c+1)*e-e/2;a.save(),a.translate(b,c);var h=a.createRadialGradient(0,0,0,0,0,g),i=d.color.toRGB();3..times(function(a){i.a=.1+a*.07,h.addColorStop(.65+a*.1,i)}),7..times(function(a){i.a=.5+a*.05,h.addColorStop(.93+a*.01,i)}),a.beginPath(),a.fillStyle=h,a.arc(0,0,g,0,f*2,1),a.fill();var j=g/7;a.fillStyle="rgba(255,255,255,.8)",a.beginPath(),a.translate(-g/2,-g/2),a.rotate(-f/4),a.scale(1,.5),a.arc(0,0,j,0,f*2,1),a.fill(),a.translate(-b,-c),a.restore()}},j={};Object.keys(i).forEach(function(a){var b=i[a];i[a]=function(c,d,e,f){var g=TetrisGame.unit,h=a+"."+f.id,i=d*g,k=e*g,l=j[h];l?c.putImageData(l,i,k):(b.apply(null,arguments),j[h]=c.getImageData(i,k,g,g))}});var k="classic",l=Object.create({},{themes:{get:function(){return Object.keys(i)}},currentTheme:{get:function(){return k},set:function(a){k!==a&&this.themes.indexOf(a)>-1&&(k=a)}},randomizeTheme:{value:function(){var a=this.themes.filter(function(a){return a!==this.currentTheme},this);this.currentTheme=a[d(a.length-1)]}},draw:{value:function(a,b,c,d){i[this.currentTheme].apply(null,arguments)}},drawPreview:{value:function(a){if(!a)return;var b=TetrisGame.nextContext,c=a.parts,d=function(a){return c.map(function(b){return b.add(a)})},f=function(a,b){return Math.min.apply(null,a.map(function(a){return a[b]}))},g=function(a,b){return Math.max.apply(null,a.map(function(a){return a[b]}))},h=e([f(c,"x"),f(c,"y")]),i=e([g(c,"x"),g(c,"y")]),j=d(h.mul(-1));this.resetCanvas(b,i.x-h.x+1,i.y-h.y+1),j.forEach(function(c){this.draw(b,c.x,c.y,a.type)},this)}},resetCanvas:{value:function(a,b,c,d){var e=TetrisGame.unit,f=b*e,g=c*e;a.canvas.width=f,a.canvas.height=g,a.canvas.style.width=f*d+"px",a.canvas.style.height=g*d+"px"}}});c.exports=l});
define("./tetris/util",[],function(a,b,c){b.array={orderBy:function(a,b){var c=typeof b=="function"?b:function(){return this[b]},d=function(a,b){return a=c.call(a,a),b=c.call(b,b),a>b?1:a<b?-1:0};return a.slice().sort(d)},maxBy:function(a,b){return this.orderBy(a,b).last()},minBy:function(a,b){return this.orderBy(a,b).first()}}});
define("./tetris/wall",["../wo/wo","../wo/stage","../wo/entities","./brick","./brickdrawer"],function(a,b,c){var d=a("../wo/wo"),e=a("../wo/stage"),f=a("../wo/entities").Entity,g=a("./brick"),h=a("./brickdrawer"),i=f.extend({map:[],width:0,height:0,init:function(){this._super(),this.width=TetrisGame.maxCols,this.height=TetrisGame.maxRows;var a=d.repeat(0,this.width);Object.defineProperties(this,{rows:{get:function(){return this.map}},cols:{get:function(){return g.rotateShape(this.map,!0)}},tmplRow:{get:function(){return a.slice()}}}),this.map=[],this.height.times(function(){this.map.push(this.tmplRow)},this)},draw:function(a){var b=this;this.map.forEach(function(b,c){b.forEach(function(b,d){b&&h.draw(a,d,c,b)})})},inspect:function(a,b){a||(a="■"),b||(b="□");var c="\n",d=" ",e=this.map.map(function(c){return c.map(function(c){return c&&a||b}).join(d)});return c+e.join(c)+c},update:function(){},add:function(a){var b=this.map;a.parts.forEach(function(c){c.x>=0&&c.x<=this.width&&c.y>=0&&c.y<=this.height&&(b[c.y][c.x]=a.type)},this),e.remove(a),this.eraseRows(),g.spawn()},collideWith:function(a){var b=this.map,c=this.height;return a.some(function(a){var d=b[a.y];return a.y>=c||d&&d[a.x]})},edgeCollideWith:function(a){var b=this.width;return a.some(function(a){return a.x<0||a.x>=b})},eraseRow:function(a){var b=this.map;b.splice(a,1),b.unshift(this.tmplRow)},eraseRows:function(){var a=this.getFullRows(),b=a.length;b&&(a.forEach(this.eraseRow,this),this.emit("eraseRows",b))},getFullRows:function(){return this.rows.map(function(a,b){var c=a.every(function(a){return a!==0});return c&&b}).filter(Boolean)}});c.exports=i});
define("./tetris/background",["../wo/stage"],function(a,b,c){var d=a("../wo/stage"),e=!1,f=null,g=function(){f.beginPath(),f.lineWidth=.1,f.strokeStyle="rgba(238,238,238,1)";var a=function(a,b,c,d){f.font="10px Tahoma",f.textAlign="center",f.fillStyle=d||"rgba(204,204,204,.5)",f.fillText(a,b,c)},b=TetrisGame.unit,c=d.width,e=d.height,g=e/b,h=c/b,i=b/2;g.times(function(a){var d=b*a;h.times(function(a){var g=b*a;f.moveTo(0,d),f.lineTo(c,d),f.moveTo(g,0),f.lineTo(g,e)})}),f.stroke(),f.closePath()};b.init=function(a){f=a,e=!0},b.draw=function(){if(!e)return;h(),g()};var h=b.clear=function(){f.clearRect(0,0,d.width,d.height)}});